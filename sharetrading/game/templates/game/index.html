<!DOCTYPE HTML>
<html>

<head>


	<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

</head>

<body>
    {{ num }}
    <script>
        var xVal = 0;
        var BlueSkyyVal = 30;
        var BlueSkySharesOwned = 0;
        var RedSunyVal = 30;
        var RedSunSharesOwned = 0;
        var GreenTreeyVal = 30;
        var GreenTreeSharesOwned = 0;
        var updateInterval = 400;
        var dataLength = 0; // number of dataPoints visible at any point
        var increment = 0;
        var duration = 60;
        var myVar = 0;

        var currentCash = 500;

        window.onload = function() {

            var BlueSkyData = []; // BlueSky data points
            var RedSunData = []; // RedSun data points
            var GreenTreeData = []; // GreenTree data points
            var EmptyData = []; // empty data set used for chart formatting
            var chart = new CanvasJS.Chart("chartContainer", {
                title: {
                    text: null
                },
                axisY: {
                    includeZero: true
                },
                data: [{
                    type: "line",
                    dataPoints: BlueSkyData,
                    name: "BlueSky",
                    showInLegend: true
                }, {
                    type: "line",
                    dataPoints: RedSunData,
                    name: "RedSun",
                    showInLegend: true
                }, {
                    type: "line",
                    dataPoints: GreenTreeData,
                    name: "GreenTree",
                    showInLegend: true
                }, {
                    type: "line",
                    dataPoints: EmptyData,
                    name: "EmptyData",
                    showInLegend: false,
                    color: "rgba(255,250,250,0)",
                    gridColor: "rgba(255,250,250,0)" 
                }]
            });


            EmptyData.push({
                        x: 5,
                        y: 40
                    });

            EmptyData.push({
                        x: 60,
                        y: 5
                    });

            var updateChart = function(count) {

                document.getElementById("overallValue").innerHTML = currentCash + (BlueSkySharesOwned * BlueSkyyVal) + (RedSunSharesOwned * RedSunyVal) + (GreenTreeSharesOwned * GreenTreeyVal);
                document.getElementById("numTotalShares").innerHTML = BlueSkySharesOwned + RedSunSharesOwned + GreenTreeSharesOwned;
                document.getElementById("currentBVal").innerHTML = BlueSkyyVal;
                document.getElementById("currentRVal").innerHTML = RedSunyVal;
                document.getElementById("currentGVal").innerHTML = GreenTreeyVal;

                count = count || 1;

                for (var j = 0; j < count; j++) {
                    BlueSkyyVal = BlueSkyyVal + Math.round(1.05 + Math.random() * (-1 - 1));
                    RedSunyVal = RedSunyVal + Math.round(1.05 + Math.random() * (-1 - 1));
                    GreenTreeyVal = GreenTreeyVal + Math.round(1.05 + Math.random() * (-1 - 1));
                    BlueSkyData.push({
                        x: xVal,
                        y: BlueSkyyVal,
                        markerType: "none"
                    });
                    RedSunData.push({
                        x: xVal,
                        y: RedSunyVal,
                        markerType: "none"
                    });
                    GreenTreeData.push({
                        x: xVal,
                        y: GreenTreeyVal,
                        markerType: "none"
                    });
                    xVal++;
                }

                //if (dps.length > dataLength) {
                //	dps.shift();
                //}

                chart.render();

                increment++;
                if (increment == duration) {
                    myStopFunction(myVar);
                }
            };

            updateChart(dataLength); // call updateChart once with the initial dataLength as argument
            myVar = setInterval(function() {
                updateChart()
            }, updateInterval); // repetitively call updateChart with no argument (hence, count will be 1 at the start of the updateChart function

        }

        function buyFunction(companyName) {
        	if (increment == duration) {
        		document.getElementById("errorMessage").innerHTML = "The game has finished!";
        		return;
        	} else {
        		document.getElementById("errorMessage").innerHTML = "";
        	}
            if (companyName == ("BlueSky")) {
            	if (!(currentCash >= BlueSkyyVal)) {
            		document.getElementById("errorMessage").innerHTML = "You don't have enough cash to buy BlueSky";
            		return;
            	}
                currentCash = currentCash - BlueSkyyVal;
                BlueSkySharesOwned++;
                //document.getElementById("currentBVal").innerHTML = ;
                document.getElementById("numBShares").innerHTML = BlueSkySharesOwned;
                document.getElementById("valBShares").innerHTML = BlueSkySharesOwned * BlueSkyyVal;
            } else if (companyName == ("RedSun")) {
                if (!(currentCash >= RedSunyVal)) {
            		document.getElementById("errorMessage").innerHTML = "You don't have enough cash to buy RedSun";
            		return;
            	}
                currentCash = currentCash - RedSunyVal;
                RedSunSharesOwned++;
                document.getElementById("numRShares").innerHTML = RedSunSharesOwned;
                document.getElementById("valRShares").innerHTML = RedSunSharesOwned * RedSunyVal;
            } else if (companyName == ("GreenTree")) {
            	if (!(currentCash >= GreenTreeyVal)) {
            		document.getElementById("errorMessage").innerHTML = "You don't have enough cash to buy GreenTree";
            		return;
            	}
                currentCash = currentCash - GreenTreeyVal;
                GreenTreeSharesOwned++;
                document.getElementById("numGShares").innerHTML = GreenTreeSharesOwned;
                document.getElementById("valGShares").innerHTML = GreenTreeSharesOwned * GreenTreeyVal;
            }

            document.getElementById("errorMessage").innerHTML = "Share bought";

            document.getElementById("currentCashDiv").innerHTML = currentCash;
            document.getElementById("overallValue").innerHTML = currentCash + (BlueSkySharesOwned * BlueSkyyVal) + (RedSunSharesOwned * RedSunyVal) + (GreenTreeSharesOwned * GreenTreeyVal);
            document.getElementById("numTotalShares").innerHTML = BlueSkySharesOwned + RedSunSharesOwned + GreenTreeSharesOwned;

        }

        function myStopFunction(myVar) {
            clearInterval(myVar);
        }

        function sellFunction(companyName) {
        	if (increment == duration) {
        		document.getElementById("errorMessage").innerHTML = "The game has finished!";
        		return;
        	}
            if (companyName == ("BlueSky")) {
            	if (BlueSkySharesOwned == 0) {
            		document.getElementById("errorMessage").innerHTML = "You have no BlueSky shares to sell";
            		return;
            	}
                currentCash = currentCash + BlueSkyyVal;
                BlueSkySharesOwned--;
                document.getElementById("numBShares").innerHTML = BlueSkySharesOwned;
                document.getElementById("valBShares").innerHTML = BlueSkySharesOwned * BlueSkyyVal;
            } else if (companyName == ("RedSun")) {
                if (RedSunSharesOwned == 0) {
            		document.getElementById("errorMessage").innerHTML = "You have no RedSun shares to sell";
            		return;
            	}
                currentCash = currentCash + RedSunyVal;
                RedSunSharesOwned--;
                document.getElementById("numRShares").innerHTML = RedSunSharesOwned;
                document.getElementById("valRShares").innerHTML = RedSunSharesOwned * RedSunyVal;
            } else if (companyName == ("GreenTree")) {
            	if (GreenTreeSharesOwned == 0) {
            		document.getElementById("errorMessage").innerHTML = "You have no GreenTree shares to sell";
            		return;
            	}
                currentCash = currentCash + GreenTreeyVal;
                GreenTreeSharesOwned--;
                document.getElementById("numGShares").innerHTML = GreenTreeSharesOwned;
                document.getElementById("valGShares").innerHTML = GreenTreeSharesOwned * GreenTreeyVal;
            }

            document.getElementById("errorMessage").innerHTML = "Share sold";

            document.getElementById("currentCashDiv").innerHTML = currentCash;
            document.getElementById("overallValue").innerHTML = currentCash + (BlueSkySharesOwned * BlueSkyyVal) + (RedSunSharesOwned * RedSunyVal) + (GreenTreeSharesOwned * GreenTreeyVal);
            document.getElementById("numTotalShares").innerHTML = BlueSkySharesOwned + RedSunSharesOwned + GreenTreeSharesOwned;
        }
    </script>

    <div align="center">
    	<h1>Share Trading</h1>

    	<div style="width:800px;">
    	<p>Welcome to the share trading game. Your job is to buy and sell the 3 companies below with the aim of making a profit. The share prices of the 3 companies will evolve over time - try to buy when the price is low, and sell when the price is high!
    	</p>
    </div>
    </div>


    <div id="chartContainer" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <div align="center"><p id="errorMessage">Status</p></div>

    <div align="center">
    </br>
	    <button type="button" onclick="buyFunction('BlueSky')">Buy BlueSky</button>
	    <button type="button" onclick="buyFunction('RedSun')">Buy RedSun</button>
	    <button type="button" onclick="buyFunction('GreenTree')">Buy GreenTree</button>
	    </br></br>
	    <button type="button" onclick="sellFunction('BlueSky')">Sell BlueSky</button>
	    <button type="button" onclick="sellFunction('RedSun')">Sell RedSun</button>
	    <button type="button" onclick="sellFunction('GreenTree')">Sell GreenTree</button>
    </div>

    </br>

    <div align="center">

	    <style type="text/css">
	        .tg {
	            border-collapse: collapse;
	            border-spacing: 0;
	        }
	        
	        .tg td {
	            font-family: Arial, sans-serif;
	            font-size: 14px;
	            padding: 10px 5px;
	            border-style: solid;
	            border-width: 1px;
	            overflow: hidden;
	            word-break: normal;
	            border-color: black;
	        }
	        
	        .tg th {
	            font-family: Arial, sans-serif;
	            font-size: 14px;
	            font-weight: normal;
	            padding: 10px 5px;
	            border-style: solid;
	            border-width: 1px;
	            overflow: hidden;
	            word-break: normal;
	            border-color: black;
	        }
	        
	        .tg .tg-1wig {
	            font-weight: bold;
	            text-align: left;
	            vertical-align: top
	        }
	        
	        .tg .tg-0lax {
	            text-align: left;
	            vertical-align: top
	        }
	    </style>
	    <table class="table">
	        <tr>
	            <th class="tg-0lax"></th>
	            <th class="tg-0lax">Current Value</th>
	            <th class="tg-0lax">Number of Shares</th>
	            <th class="tg-0lax">Value of Holding</th>
	        </tr>
	        <tr>
	            <td class="tg-0lax">BlueSky</td>
	            <td class="tg-0lax" id="currentBVal">0</td>
	            <td class="tg-0lax" id="numBShares">0</td>
	            <td class="tg-0lax" id="valBShares">0</td>
	        </tr>
	        <tr>
	            <td class="tg-0lax">RedSun</td>
	            <td class="tg-0lax" id="currentRVal">0</td>
	            <td class="tg-0lax" id="numRShares">0</td>
	            <td class="tg-0lax" id="valRShares">0</td>
	        </tr>
	        <tr>
	            <td class="tg-0lax">GreenTree</td>
	            <td class="tg-0lax" id="currentGVal">0</td>
	            <td class="tg-0lax" id="numGShares">0</td>
	            <td class="tg-0lax" id="valGShares">0</td>
	        </tr>
	        <tr>
	            <td class="tg-0lax">Cash</td>
	            <td class="tg-0lax">---</td>
	            <td class="tg-0lax">---</td>
	            <td class="tg-0lax" id="currentCashDiv">500</td>
	        </tr>
	        <tr>
	            <td class="tg-1wig">Total</td>
	            <td class="tg-0lax">---</td>
	            <td class="tg-1wig" id="numTotalShares">0</td>
	            <td class="tg-1wig" id="overallValue"></td>
	        </tr>
	    </table>
	</div>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</body>

</html>
